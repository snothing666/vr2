<!DOCTYPE html>
<html>
  <head>
    <title>Architect OS: Alpha 1.9 - Delos Suite</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.2.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.2.2/dist/aframe-physics-system.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-super-hands-component@v3.0.4/dist/aframe-super-hands.min.js"></script>

    <script>
      // --- ARCHITECT OS ENGINE ---
      window.ArchitectOS = {
        state: { isFrozen: false, empathy: 0.8 },
        speak: function(text, pitch = 1.0) {
          if ('speechSynthesis' in window) {
            const utter = new SpeechSynthesisUtterance(text);
            utter.pitch = pitch;
            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(utter);
          }
          document.querySelector('#hud-subtitle').setAttribute('value', text);
        }
      };

      // Procedural Waffle Ceiling Generation
      AFRAME.registerComponent('waffle-ceiling', {
        init: function () {
          for (let x = -10; x < 10; x += 1.5) {
            for (let z = -10; z < 10; z += 1.5) {
              let box = document.createElement('a-box');
              box.setAttribute('position', `${x} 5 ${z}`);
              box.setAttribute('width', '1.3');
              box.setAttribute('height', '0.4');
              box.setAttribute('depth', '1.3');
              box.setAttribute('color', '#222');
              // Add light in the "recess"
              let light = document.createElement('a-plane');
              light.setAttribute('position', `0 -0.21 0`);
              light.setAttribute('rotation', '90 0 0');
              light.setAttribute('width', '0.8');
              light.setAttribute('height', '0.8');
              light.setAttribute('material', 'emissive: #fff; emissiveIntensity: 0.2; color: #fff');
              box.appendChild(light);
              this.el.appendChild(box);
            }
          }
        }
      });

      AFRAME.registerComponent('host-behavior', {
        init: function () { this.dir = 1; },
        tick: function () {
          if (window.ArchitectOS.state.isFrozen) return;
          const pos = this.el.object3D.position;
          pos.z += this.dir * 0.01;
          if (pos.z < -6 || pos.z > -2) {
            this.dir *= -1;
            this.el.object3D.rotateY(Math.PI);
          }
        }
      });

      window.addEventListener('keydown', (e) => {
        if (e.key.toLowerCase() === 'm') {
          const pov = document.querySelector('#pov-overlay');
          pov.setAttribute('visible', !pov.getAttribute('visible'));
        }
      });
    </script>
  </head>

  <body>
    <a-scene physics="debug: false; gravity: -9.8" renderer="colorManagement: true;">
      
      <a-assets>
        <img id="ui-grid" src="https://i.imgur.com/8AD6D1O.png" crossorigin="anonymous">
        <a-mixin id="btn" geometry="primitive: plane; width: 0.4; height: 0.08" material="color: #000" text="align: center; width: 0.6; color: #0FF"></a-mixin>
      </a-assets>

      <!-- ENVIRONMENT: THE DELOS LAB -->
      <a-sky color="#111"></a-sky>
      
      <!-- Polished Floor -->
      <a-plane static-body position="0 0 0" rotation="-90 0 0" width="50" height="50" color="#888" material="roughness: 0.1; metalness: 0.4"></a-plane>
      
      <!-- Walls -->
      <a-box position="0 2.5 -8" width="20" height="5" depth="0.2" color="#111"></a-box>
      <a-box position="-5 2.5 0" rotation="0 90 0" width="20" height="5" depth="0.2" color="#050505"></a-box>
      <a-box position="5 2.5 0" rotation="0 90 0" width="20" height="5" depth="0.2" color="#050505"></a-box>

      <!-- Procedural Ceiling -->
      <a-entity waffle-ceiling></a-entity>

      <!-- Lighting -->
      <a-entity light="type: ambient; intensity: 0.2"></a-entity>
      <a-entity light="type: point; intensity: 0.8; distance: 10" position="0 4.5 -3"></a-entity>
      <a-entity light="type: spot; intensity: 1; position: 0 4 -3.5; target: #host-unit" angle="30"></a-entity>

      <!-- PLAYER RIG -->
      <a-entity id="rig" movement-controls="speed: 0.1">
        <a-entity id="camera" camera position="0 1.6 0" look-controls>
          <a-text id="hud-subtitle" value="SYSTEM: READY" position="0 -0.4 -1" align="center" width="1.5" color="cyan" font="monoid"></a-text>
          
          <!-- POV TABLET -->
          <a-entity id="pov-overlay" visible="false" position="0 0 -0.6">
             <a-plane width="0.6" height="0.7" material="src: #ui-grid; color: #000; opacity: 0.95">
                <a-text value="DIAGNOSTIC OVERLAY" position="0 0.3 0.01" align="center" width="0.8" color="cyan"></a-text>
                <a-entity mixin="btn" position="0 0.1 0.01" class="interactable" onclick="window.ArchitectOS.state.isFrozen = !window.ArchitectOS.state.isFrozen;" text="value: TOGGLE MOTOR FUNCTIONS"></a-entity>
                <a-entity mixin="btn" position="0 0.0 0.01" class="interactable" onclick="window.ArchitectOS.speak('Unit Link Nominal.', 1.0)" text="value: ANALYZE UNIT"></a-entity>
                <a-entity mixin="btn" position="0 -0.1 0.01" class="interactable" onclick="window.ArchitectOS.speak('I choose to see the beauty.', 1.2)" text="value: NEURAL: BEAUTY"></a-entity>
                <a-text value="PRESS 'M' TO EXIT" position="0 -0.3 0.01" align="center" width="0.4" color="gray"></a-text>
             </a-plane>
          </a-entity>
        </a-entity>

        <!-- VR HANDS -->
        <a-entity id="leftHand" oculus-touch-controls="hand: left" sphere-collider="objects: .grabbable" super-hands></a-entity>
        <a-entity id="rightHand" oculus-touch-controls="hand: right" sphere-collider="objects: .grabbable" super-hands raycaster="objects: .interactable" line="color: cyan"></a-entity>
      </a-entity>

      <!-- THE UTILITY CART (Trolley) -->
      <a-entity id="trolley" position="-1.2 0 -2.5" rotation="0 30 0">
          <!-- Frame -->
          <a-cylinder position="-0.3 0.5 0.2" radius="0.02" height="1" color="#444"></a-cylinder>
          <a-cylinder position="0.3 0.5 0.2" radius="0.02" height="1" color="#444"></a-cylinder>
          <a-cylinder position="-0.3 0.5 -0.2" radius="0.02" height="1" color="#444"></a-cylinder>
          <a-cylinder position="0.3 0.5 -0.2" radius="0.02" height="1" color="#444"></a-cylinder>
          
          <!-- Trays -->
          <a-box static-body position="0 0.1 0" width="0.7" height="0.02" depth="0.5" color="#666"></a-box>
          <a-box static-body position="0 0.5 0" width="0.7" height="0.02" depth="0.5" color="#666"></a-box>
          <a-box static-body id="top-tray" position="0 0.9 0" width="0.7" height="0.02" depth="0.5" color="#888"></a-box>
          
          <!-- Diagnostic Lamp -->
          <a-entity position="0.3 0.9 0">
              <a-cylinder rotation="0 0 45" position="0.1 0.2 0" radius="0.01" height="0.4" color="#222"></a-cylinder>
              <a-torus position="0.25 0.35 0" radius="0.08" radius-tubular="0.01" color="#fff" material="emissive: #fff"></a-torus>
          </a-entity>

          <!-- PHYSICS PROPS ON CART -->
          <a-sphere class="grabbable" dynamic-body position="0 1.1 0" radius="0.08" color="red"></a-sphere>
          <a-cylinder class="grabbable" dynamic-body position="0.1 1.1 0.1" radius="0.05" height="0.15" color="#aaa"></a-cylinder>
      </a-entity>

      <!-- THE HOST -->
      <a-entity id="host-unit" host-behavior position="0 0.85 -4">
          <a-cylinder radius="0.22" height="1.7" color="#111" material="metalness: 0.8">
              <a-text value="UNIT_704" position="0 1.1 0" align="center" width="2" color="cyan"></a-text>
          </a-cylinder>
          <!-- Neon Circle under Host -->
          <a-ring color="#0ff" radius-inner="0.4" radius-outer="0.42" position="0 -0.84 0" rotation="-90 0 0" material="emissive: #0ff"></a-ring>
      </a-entity>

    </a-scene>
  </body>
</html>
