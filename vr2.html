<!DOCTYPE html>
<html>
  <head>
    <title>Architect OS: Alpha 2.4 - Full Body</title>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.2.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.2.2/dist/aframe-physics-system.min.js"></script>
    <script src="https://unpkg.com/aframe-aabb-collider-component@3.2.2/dist/aframe-aabb-collider-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-super-hands-component@v3.0.4/dist/aframe-super-hands.min.js"></script>

    <script>
      // --- ARCHITECT OS CORE ---
      window.ArchitectOS = {
        state: { isFrozen: false },
        speak: function(text, pitch = 1.0) {
          if ('speechSynthesis' in window) {
            const utter = new SpeechSynthesisUtterance(text);
            utter.pitch = pitch;
            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(utter);
          }
          document.querySelector('#hud-subtitle').setAttribute('value', text);
        },
        spawn: function(type) {
          const scene = document.querySelector('a-scene');
          const newEl = document.createElement('a-entity');
          const cam = document.querySelector('#camera');
          const pos = new THREE.Vector3(0, 0, -2);
          cam.object3D.localToWorld(pos);
          newEl.setAttribute('position', {x: pos.x, y: 0.1, z: pos.z});

          if (type === 'host') {
            newEl.setAttribute('geometry', 'primitive: cylinder; radius: 0.25; height: 1.7');
            newEl.setAttribute('material', 'color: #222; metalness: 0.8');
            newEl.setAttribute('static-body', '');
            newEl.setAttribute('host-behavior', '');
            this.speak("Host Unit Manifested.");
          } else if (type === 'chair') {
            newEl.setAttribute('geometry', 'primitive: box; width: 0.5; height: 0.5; depth: 0.5');
            newEl.setAttribute('material', 'color: #111');
            newEl.setAttribute('static-body', '');
            this.speak("Furniture Manifested.");
          }
          scene.appendChild(newEl);
        }
      };

      // --- COMPONENT: PLAYER BODY LOGIC ---
      AFRAME.registerComponent('player-body', {
        tick: function () {
          const cam = document.querySelector('#camera').object3D;
          const torso = document.querySelector('#torso').object3D;
          
          // Keep torso under head
          torso.position.set(cam.position.x, cam.position.y - 0.5, cam.position.z);
          
          // Rotate torso slightly with head, but lag it for realism
          const camYaw = cam.rotation.y;
          torso.rotation.y = camYaw;
        }
      });

      // --- COMPONENT: ARM VECTORING ---
      AFRAME.registerComponent('arm-follow', {
        schema: { hand: {type: 'string'} },
        tick: function () {
          const hand = document.querySelector(this.data.hand).object3D;
          const shoulder = new THREE.Vector3(this.data.hand === '#leftHand' ? -0.2 : 0.2, 0.4, -0.1);
          const torso = document.querySelector('#torso').object3D;
          
          // Get shoulder world position
          torso.localToWorld(shoulder);
          
          // Point arm from shoulder to hand
          this.el.object3D.position.copy(shoulder);
